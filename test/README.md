# SUPCON 工厂仿真系统 - 测试套件

## 🚀 快速开始

运行测试菜单：
```bash
python test/run_tests.py
```

**推荐：** 直接选择选项3运行故障诊断演示，5分钟内了解所有核心功能！

## 📋 测试文件说明

### 1. `run_tests.py` - 测试套件主入口 ⭐
交互式菜单，方便选择和运行各种测试，支持系统状态检查

### 2. `test_factory_simulation.py` - 基础功能测试
验证核心系统功能：
- ✅ 工厂初始化和设备状态管理
- ✅ MQTT消息发布和订阅  
- ✅ 订单生成和处理流程
- ✅ KPI计算和统计

### 3. `test_interactive_factory.py` - 交互式体验 🎮
亲自体验AI Agent开发者的工作流程：
- 🔍 实时查看工厂状态
- 💥 手动故障注入和诊断
- 🤖 模拟Agent决策过程
- 📡 学习MQTT消息格式

### 4. `test_fault_diagnosis_demo.py` - 智能故障诊断演示 🧠⭐
**强烈推荐！** 展示PRD 3.2改进后的智能故障诊断功能：

#### 🎯 核心改进展示：
1. **症状导向诊断** - 玩家只能看到症状，需通过探索学习根因
2. **智能奖惩机制** - 正确诊断获得基础修复时间，错误诊断触发惩罚
3. **连锁反应系统** - 错误诊断可能影响关联设备，增加复杂性
4. **学习过程模拟** - 演示AI Agent如何通过试错建立知识库
5. **灵活控制选项** - 提供跳过等待时间的机制

#### 🧠 对AI Agent开发的意义：
- 💡 需要开发探索策略来学习故障模式
- 🧠 需要记忆和推理能力来建立知识库
- ⚖️ 需要权衡风险：快速尝试 vs 谨慎分析
- 🔗 需要考虑设备间关系，避免连锁故障
- 📊 需要优化诊断策略以提高成功率

### 5. `test_performance_benchmark.py` - 性能基准测试 ⚡
评估系统性能：高并发处理、内存使用、长时间稳定性

### 6. `test_fault_freeze_recovery.py` - 故障冻结与恢复测试 🧊⭐
**专项测试！** 验证流水线故障冻结和恢复机制：

#### 🎯 测试场景：
1. **正常产品流动** - 验证流水线基础运行
2. **故障冻结阻塞** - 注入故障导致设备冻结，产品阻塞
3. **修复恢复流动** - 故障修复后产品继续流动

#### 🔧 测试的核心机制：
- 设备故障时的锁定和冻结状态
- 错误诊断导致的惩罚性冻结
- 产品在流水线中的阻塞行为
- 故障修复后的流动恢复能力
- 整个系统的容错恢复机制

## 🎯 推荐使用流程

### 🆕 新用户（5分钟快速了解）
```
1. python test/run_tests.py
2. 选择选项3：故障诊断系统演示
3. 观察5个演示场景，理解核心改进
4. 可选：选择选项2体验交互式操作
```

### 🤖 AI Agent开发者
```
1. 选择选项1：验证基础功能
2. 选择选项3：学习智能故障诊断机制 ⭐ 
3. 选择选项2：熟悉MQTT接口
4. 开始开发您的智能Agent！
```

### 🔧 系统验证
```
1. 选择选项5：运行所有自动化测试
2. 确保所有测试通过
3. 系统准备就绪！
```

## 💡 故障诊断系统亮点

相比传统方式，新系统具有以下优势：

| 传统方式 | 智能诊断系统 |
|---------|-------------|
| 直接暴露根因 | 🔍 仅显示症状，需探索学习 |
| 固定修复时间 | ⚖️ 根据诊断准确性动态调整 |
| 独立设备故障 | 🔗 考虑设备关联，可能连锁反应 |
| 一次性诊断 | 🧠 支持多次尝试，积累经验 |
| 强制等待 | ⏭️ 正确诊断可选择跳过等待 |

## 📊 系统配置

- **设备配置**: 4个工作站 + 2个AGV
- **故障类型**: 5种（振动异常、精度下降、路径阻塞、电量突降、效率异常）
- **产品类型**: 3种（ProductA、ProductB、ProductC）
- **仿真性能**: 1000x+ 实时速度
- **MQTT主题**: 11+个实时数据流

## ❓ 常见问题

**Q: 最快了解系统功能的方法？**
A: 运行`test_fault_diagnosis_demo.py`，5分钟内了解所有核心改进

**Q: 测试失败怎么办？**
A: 运行测试菜单选项6查看系统状态，检查环境配置

**Q: 如何理解故障诊断机制？**
A: 故障诊断演示包含5个场景，从症状诊断到学习过程全覆盖

**Q: 准备开发Agent需要什么？**
A: 了解MQTT接口（选项2）+ 理解故障机制（选项3）即可开始

## 🏆 系统优势

1. **🎯 智能化** - 症状导向诊断，符合真实工业场景
2. **🧠 学习型** - 支持AI Agent通过探索建立知识库  
3. **🔗 系统性** - 考虑设备关联，增加决策复杂性
4. **⚖️ 平衡性** - 奖惩机制平衡挑战和体验
5. **🚀 高性能** - 1000x实时速度，支持快速迭代

---

🎉 **现在您可以开始开发智能故障诊断Agent了！** 